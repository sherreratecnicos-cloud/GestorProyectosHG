default_platform(:ios)

platform :ios do
  desc "CI build: generate .ipa unsigned (for CI/testing). Uses xcodebuild export with exportOptionsPlist for ad-hoc if provided."
  lane :ci_build do
    # Generate project (if using XcodeGen this should already be run in CI prior to fastlane)
    # increment_build_number(xcodeproj: "GestorProyectosHG.xcodeproj")
    build_app(
      workspace: nil,
      project: "GestorProyectosHG.xcodeproj",
      scheme: "GestorProyectosHG",
      clean: true,
      export_method: "ad-hoc",
      export_options: {
        compileBitcode: false
      },
      output_directory: "./build",
      export_xcargs: "-allowProvisioningUpdates"
    )
  end

  desc "Release to TestFlight (requires signing: App Store Connect API key or certificates configured in CI)"
  lane :release do
    capture_screenshots
    build_app(
      project: "GestorProyectosHG.xcodeproj",
      scheme: "GestorProyectosHG",
      export_method: "app-store",
      output_directory: "./build"
    )
    upload_to_testflight
  end
end
